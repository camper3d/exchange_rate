<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8" />
    <title>Курсы валют</title>
    <style>
      body { font-family: Arial, sans-serif; margin: 40px; }
      table { border-collapse: collapse; width: 400px; }
      th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
      th { background-color: #f2f2f2; }
      button { margin-top: 20px; padding: 10px 20px; }
    </style>
</head>
<body>
    <h1>Курсы валют (NBRB)</h1>
    <table>
        <thead>
            <tr>
                <th>Валюта</th>
                <th>Курс (за единицу)</th>
            </tr>
        </thead>
        <tbody id="rates-table-body">
            <tr><td colspan="2">Загрузка данных...</td></tr>
        </tbody>
    </table>

    <button id="refresh-btn">Обновить</button>

    <script>
        const currencies = ['USD', 'EUR', 'RUB'];

        async function fetchRates() {
            const tbody = document.getElementById('rates-table-body');
            tbody.innerHTML = '<tr><td colspan="2">Загрузка данных...</td></tr>';

            try {
                const response = await fetch('/rates/');
                if (!response.ok) throw new Error('Ошибка при получении данных');

                const data = await response.json();
                const filtered = data.filter(item => currencies.includes(item.Cur_Abbreviation));

                if (filtered.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="2">Нет данных</td></tr>';
                    return;
                }

                tbody.innerHTML = filtered.map(item => `
                    <tr>
                        <td>${item.Cur_Abbreviation} (${item.Cur_Name})</td>
                        <td>${(item.Cur_OfficialRate / item.Cur_Scale).toFixed(4)}</td>
                    </tr>
                `).join('');
            } catch (error) {
                tbody.innerHTML = '<tr><td colspan="2">Ошибка загрузки данных</td></tr>';
                console.error(error);
            }
        }

        document.getElementById('refresh-btn').addEventListener('click', fetchRates);

        // Автообновление каждые 60 секунд
        setInterval(fetchRates, 60000);

        // Загрузка данных при старте
        fetchRates();
    </script>
</body>
</html>
